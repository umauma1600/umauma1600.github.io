# 逆転の宝箱 - 仕様書

## 📋 基本情報

| 項目 | 内容 |
|------|------|
| **コンテンツ名** | 逆転の宝箱 |
| **ディレクトリ名** | `contents/treasure-box/` |
| **難易度** | 初心者向け |
| **想定プレイ時間** | 10分 |
| **作成日** | 2025-12-27 |

---

## 🎮 ゲーム概要

4桁のダイヤル錠がかかった古びた宝箱。
プレイヤーはダイヤル錠を解いて宝箱を開けようとするが...
実は宝箱の底が抜けている！固定観念を逆転させる謎解き。

**キャッチコピー案**:
「常識にとらわれていませんか？」

---

## 📖 ストーリー

あなたは古い部屋で不思議な宝箱を見つけた。
宝箱には4桁のダイヤル錠がかかっている。
部屋を調べて、ダイヤル錠の暗号を解き明かそう。

しかし、錠を外しても宝箱は開かない...
そのとき、あなたは気づくだろう。
**「逆転の発想」**が必要だということに。

宝箱を開けて、中にある紙に書かれたキーワードを入力してクリアを目指せ！

---

## 🎯 ゲームフロー

### フェーズ1: ダイヤル錠の謎解き

1. **初期状態**
   - 画面中央に4桁ダイヤル錠付きの木製宝箱が表示
   - 宝箱は固定（まだドラッグ不可）
   - 画面上にキーワード入力欄が存在（最初から表示）
   - 部屋の中に調べられるオブジェクトが配置されている

2. **謎解きフェーズ**
   - プレイヤーは部屋のオブジェクトをクリック/タップして調べる
   - オブジェクトから得られる情報でダイヤル錠の4桁「1600」を推理
   - ダイヤルを回して数字を合わせる

3. **ダイヤル錠解除**
   - 正解「1600」を入力すると錠が外れる演出
   - カチャッという音（効果音なしバージョンでは視覚演出のみ）
   - しかし宝箱は開かない...

### フェーズ2: 逆転の発想

4. **ミスリード**
   - プレイヤーは宝箱をクリックして開けようとする
   - しかし宝箱は開かない
   - ヒントボタンで徐々に誘導

5. **真の解法**
   - 宝箱を**上にドラッグ**する
   - 宝箱が持ち上がると、底が抜けて中から紙がひらひらと落ちる
   - 紙には「逆転の発想」というキーワードが書かれている

6. **最終解答**
   - 画面上部（または下部）のキーワード入力欄に「逆転の発想」を入力
   - 正解でクリア演出発動！

### フェーズ3: クリア演出

7. **クリア演出**
   - 紙吹雪・クラッカーのアニメーション
   - 「おめでとうございます！」メッセージ
   - プレイ時間の表示
   - Xシェアボタン表示
     - 「逆転の宝箱をクリアしました！」

---

## 🎨 デザイン仕様

### 全体の雰囲気
- **背景**: シンプルな部屋（壁紙、床のテクスチャ程度）
- **照明**: 柔らかい自然光のイメージ
- **カラー**: サイト全体のカラーパレットに合わせる
  - `--color-primary: #3d2f23`（ブラウン）
  - `--color-accent: #c69c6d`（ゴールデンベージュ）
  - `--color-bg: #faf8f5`（アイボリー）

### 宝箱のデザイン

**見た目**:
- 木製の古びた宝箱
- 茶色ベース、少し傷や汚れの質感
- サイズ: 画面中央に配置、レスポンシブ対応
- 横幅: モバイル 80%、デスクトップ 400-500px程度

**4桁ダイヤル錠**:
- アナログなダイヤル式
- 0-9の数字が表示された4つのダイヤル
- 各ダイヤルはクリック/ドラッグで回転可能
- 現在の数字がハイライト表示
- 初期値: 0000

**宝箱の状態**:
1. **錠あり状態**: ダイヤル錠が前面に表示
2. **錠解除状態**: 錠が外れて横に開く演出、でも宝箱は開かない
3. **ドラッグ時**: 宝箱全体が上に持ち上がる
4. **底抜け状態**: 底が開いて紙がひらひら落ちる

### 調べられるオブジェクト

**配置場所**（案）:
- 部屋の壁にかかった絵画
- 棚の上の置物
- テーブルの上の本
- 窓の外の景色
- など、4つ程度のオブジェクト

**インタラクション**:
- オブジェクトにカーソルを合わせるとハイライト
- クリック/タップで拡大表示または情報パネル表示
- 情報には数字のヒントが含まれる

**ヒント内容**: ※後で詳細を設定
- オブジェクト1: 「16」に関する情報
- オブジェクト2: 「00」に関する情報
- オブジェクト3: 組み合わせのヒント
- オブジェクト4: ミスリード or 補助ヒント

### 紙のデザイン

- A4サイズ風の白い紙
- 古びた羊皮紙風も可
- 中央に「逆転の発想」と大きく書かれている
- ひらひらと落ちるアニメーション

### キーワード入力欄

**配置**:
- 画面上部または下部に固定
- 常に表示されている

**デザイン**:
- ラベル: 「キーワードを入力してください」
- 入力欄: テキストボックス（プレースホルダー: 「ひらがなで入力」）
- ボタン: 「答えを確認」

**正解判定**:
- 正解: 「逆転の発想」（ひらがな、漢字両方OK）
- 不正解時: 「違うようです...」とメッセージ表示

### ヒントボタン

**配置**:
- 画面右上または右下に固定
- 電球アイコン or 「？」マーク

**ヒント内容**: ※後で詳細を設定

**STEP1** (開始直後から見られる):
```
「部屋の中をよく調べてみましょう。何か手がかりがあるかもしれません。」
```

**STEP2** (ダイヤル錠解除後):
```
「錠は外れたのに開きません...何か別の方法があるのでは？」
```

**STEP3** (しばらく経過後):
```
「固定観念にとらわれていませんか？下からアプローチしてみては？」
```

**STEP4** (最終ヒント):
```
「宝箱を『上に』ドラッグしてみてください！」
```

---

## 🔧 技術仕様

### 使用技術
- **HTML5**: セマンティックマークアップ
- **Tailwind CSS**: スタイリング（CDN）
- **JavaScript (ES6+)**: ゲームロジック

### 実装機能

#### 1. ダイヤル錠システム
```javascript
// ダイヤルの状態管理
let dialValues = [0, 0, 0, 0];
const correctAnswer = [1, 6, 0, 0];

// ダイヤル回転処理
function rotateDial(index, direction) {
  // 0-9の範囲で循環
  dialValues[index] = (dialValues[index] + direction + 10) % 10;
  updateDialDisplay();
  checkAnswer();
}

// 正解判定
function checkAnswer() {
  if (JSON.stringify(dialValues) === JSON.stringify(correctAnswer)) {
    unlockDial();
  }
}
```

#### 2. オブジェクト調査システム
```javascript
// 調べられるオブジェクトの管理
const objects = [
  { id: 'object1', name: '絵画', info: '※後で設定', examined: false },
  { id: 'object2', name: '置物', info: '※後で設定', examined: false },
  // ...
];

// オブジェクトクリック時
function examineObject(objectId) {
  const obj = objects.find(o => o.id === objectId);
  obj.examined = true;
  showInfoPanel(obj.info);
}
```

#### 3. ドラッグ&ドロップシステム
```javascript
// 宝箱のドラッグ処理
let isDragging = false;
let startY = 0;

treasureBox.addEventListener('mousedown', (e) => {
  if (isLockUnlocked) {
    isDragging = true;
    startY = e.clientY;
  }
});

document.addEventListener('mousemove', (e) => {
  if (isDragging) {
    const deltaY = startY - e.clientY;
    if (deltaY > 100) { // 100px以上上にドラッグ
      dropBottom();
    }
  }
});
```

#### 4. クリア演出
```javascript
function showClearAnimation() {
  // 紙吹雪アニメーション（CSS + JS）
  createConfetti();

  // クリアメッセージ表示
  showClearMessage();

  // シェアボタン表示
  showShareButton();
}

// シェア機能
function shareOnX() {
  const text = encodeURIComponent('逆転の宝箱をクリアしました！ #やまーたの謎解きアトリエ');
  const url = encodeURIComponent(window.location.href);
  window.open(`https://twitter.com/intent/tweet?text=${text}&url=${url}`, '_blank');
}
```

#### 5. ヒントシステム
```javascript
const hints = [
  { step: 1, condition: 'always', text: 'STEP1のヒント' },
  { step: 2, condition: 'lockUnlocked', text: 'STEP2のヒント' },
  { step: 3, condition: 'time > 300', text: 'STEP3のヒント' },
  { step: 4, condition: 'time > 600', text: 'STEP4のヒント' },
];

let currentHintStep = 1;

function showHint() {
  const hint = hints.find(h => h.step === currentHintStep);
  displayHintModal(hint.text);
  currentHintStep++;
}
```

### レスポンシブ対応
- **モバイル（〜768px）**:
  - 縦向き配置
  - タッチ操作対応
  - ダイヤルはタップで回転
  - ドラッグはスワイプで実装

- **デスクトップ（768px〜）**:
  - 横向き余裕のある配置
  - マウスホバー効果
  - ダイヤルはクリック or ドラッグ

---

## 📁 ファイル構成

```
contents/treasure-box/
├── SPEC.md                # この仕様書
├── index.html             # メインページ
├── style.css              # カスタムスタイル
├── script.js              # ゲームロジック
└── assets/                # アセット（画像など）
    ├── treasure-box.svg   # 宝箱画像（またはPNG）
    ├── dial-lock.svg      # ダイヤル錠画像
    ├── paper.svg          # 紙の画像
    └── objects/           # 調べられるオブジェクト画像
        ├── object1.svg
        ├── object2.svg
        └── ...
```

---

## ✅ 実装チェックリスト

### Phase 1: 基本実装
- [ ] HTMLの基本構造作成
- [ ] レイアウト・デザイン実装
- [ ] ダイヤル錠UI実装
- [ ] ダイヤル回転機能実装
- [ ] 正解判定機能実装

### Phase 2: オブジェクト・謎解き
- [ ] 調べられるオブジェクト配置
- [ ] オブジェクトクリック処理
- [ ] 情報パネル表示機能
- [ ] ダイヤル錠の謎解き内容を決定
- [ ] オブジェクトのヒント内容を実装

### Phase 3: 宝箱ドラッグ
- [ ] ダイヤル錠解除演出
- [ ] 宝箱ドラッグ機能（マウス）
- [ ] 宝箱ドラッグ機能（タッチ）
- [ ] 底抜けアニメーション
- [ ] 紙が落ちる演出

### Phase 4: クリア処理
- [ ] キーワード入力欄実装
- [ ] 正解判定機能
- [ ] 紙吹雪アニメーション
- [ ] クリアメッセージ表示
- [ ] Xシェアボタン実装

### Phase 5: ヒント・UX
- [ ] ヒントボタン実装
- [ ] STEPごとのヒント表示
- [ ] ヒント内容を決定
- [ ] プレイ時間計測
- [ ] レスポンシブ対応確認

### Phase 6: 最終調整
- [ ] モバイル動作確認
- [ ] クロスブラウザ確認
- [ ] アニメーションの調整
- [ ] 謎解き難易度の調整
- [ ] トップページへのリンク追加

---

## 🎯 未決定事項（後で設定）

### ダイヤル錠の謎解き内容
- [ ] オブジェクト1の内容とヒント
- [ ] オブジェクト2の内容とヒント
- [ ] オブジェクト3の内容とヒント
- [ ] オブジェクト4の内容とヒント（任意）
- [ ] 「1600」という答えに至るロジック

### ヒント内容の詳細
- [ ] STEP1のヒント文面
- [ ] STEP2のヒント文面
- [ ] STEP3のヒント文面
- [ ] STEP4のヒント文面
- [ ] ヒント表示条件の調整

### デザインの詳細
- [ ] 宝箱の最終的なビジュアル
- [ ] 背景の部屋のデザイン
- [ ] オブジェクトの種類とデザイン
- [ ] 紙のデザイン

---

## 📝 メモ・アイデア

### 謎解きアイデア（参考）
- 「1600」という数字の導き方:
  - 16:00（時刻）
  - 16世紀00年代
  - 16 + 00 = 16
  - 数式や暗号から導く
  - オブジェクトの配置や個数

### 追加要素（検討中）
- [ ] BGM on/offボタン（将来的に）
- [ ] 多言語対応（英語版）
- [ ] ダークモード対応
- [ ] プレイ履歴の保存（localStorage）

---

## 🔄 更新履歴

| 日付 | 内容 |
|------|------|
| 2025-12-27 | 初版作成 |

---

**作成者**: Claude AI
**プロジェクト**: やまーたの謎解きアトリエ
**サイトURL**: https://umauma1600.github.io
